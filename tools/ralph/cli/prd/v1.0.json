{
  "title": "Trinity 1.0 Release",
  "shortTitle": "Release",
  "description": "Authentication, polish, and production-ready release",
  "phases": [
    {
      "id": 1,
      "name": "Authentication"
    },
    {
      "id": 2,
      "name": "Polish"
    },
    {
      "id": 3,
      "name": "Release"
    }
  ],
  "epics": [
    {
      "phase": 1,
      "id": 1,
      "name": "License Validation"
    },
    {
      "phase": 2,
      "id": 1,
      "name": "UX Polish"
    },
    {
      "phase": 2,
      "id": 2,
      "name": "Documentation"
    },
    {
      "phase": 2,
      "id": 3,
      "name": "Testing"
    },
    {
      "phase": 3,
      "id": 1,
      "name": "Release"
    }
  ],
  "stories": [
    {
      "id": "1.1.1",
      "title": "Create auth package structure",
      "intent": "Establish authentication module for license validation",
      "description": "Create the foundational auth package in core/auth/. This follows the same pattern as other core packages (config, db, etc). The Auth struct should be the main entry point, handling both in-memory state and disk persistence. Use ~/.trinity/auth.json for storage to keep user projects clean.",
      "acceptance": [
        "core/auth/auth.go exists with Auth struct",
        "Auth struct holds API endpoint URL and cached validation result",
        "Uses ~/.trinity/auth.json for storing cached license key",
        "Load() reads cached key from disk if exists",
        "Save(key) persists key to disk"
      ],
      "passes": false,
      "depends_on": [
        "v0.1"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 1,
      "target_version": "v1.0",
      "tags": [
        "api",
        "auth",
        "core",
        "validation"
      ]
    },
    {
      "id": "1.1.2",
      "title": "Implement license key validation",
      "intent": "Validate license key against auth API before running operations",
      "description": "The validation flow: Auth.Validate(key) makes a POST to the license API, parses the response into LicenseInfo, and caches the result. Use context.WithTimeout for the HTTP call (10s default). The external_deps_report will provide the actual API endpoint and response schema. Don't hardcode URLs—read from config or the report.",
      "acceptance": [
        "Validate(key) calls auth API endpoint to verify license",
        "API endpoint provided via external deps report (e.g., POST /api/licenses/validate)",
        "Returns LicenseInfo struct with: valid (bool), tier (string), expires_at (time.Time), features ([]string)",
        "Handles network errors gracefully with offline mode fallback",
        "Caches successful validation for 24 hours to reduce API calls",
        "Returns clear error for invalid/expired licenses"
      ],
      "passes": false,
      "depends_on": [
        "1.1.1"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 2,
      "target_version": "v1.0",
      "external_deps": [
        {
          "name": "License API",
          "description": "API endpoint for validating license keys. Should accept POST with {key: string} and return {valid: bool, tier: string, expires_at: timestamp, features: [string]}"
        }
      ],
      "tags": [
        "api",
        "auth",
        "validation"
      ]
    },
    {
      "id": "1.1.3",
      "title": "Implement offline validation fallback",
      "intent": "Allow Trinity to work offline when API is unreachable",
      "description": "Offline mode is critical for developer experience—users shouldn't be blocked by network issues. The cached validation in auth.json includes a timestamp. Compare against 7-day threshold. The --offline flag is a CLI flag that skips the network call entirely, useful for airplane mode or CI environments without network access.",
      "acceptance": [
        "If API unreachable and cached validation < 7 days old, allow operation",
        "If API unreachable and cached validation > 7 days old, require online validation",
        "Show warning when running in offline mode: \"Running in offline mode (last validated X days ago)\"",
        "--offline flag forces offline mode without attempting API call",
        "Log offline validation events for debugging"
      ],
      "passes": false,
      "depends_on": [
        "1.1.2"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 3,
      "target_version": "v1.0",
      "tags": [
        "api",
        "auth",
        "validation"
      ]
    },
    {
      "id": "1.1.4",
      "title": "Implement trinity auth login command",
      "intent": "Allow users to enter their license key",
      "description": "This is the main entry point for authentication. Use terminal.ReadPassword() for secure key input (hides typing). The --key flag is for CI/automation where interactive prompts don't work. Display license info nicely after successful login—users want to see what tier they have and when it expires.",
      "acceptance": [
        "trinity auth login prompts for license key",
        "Validates key immediately against API",
        "On success: saves key, shows license info (tier, expiration)",
        "On failure: shows clear error, does not save key",
        "trinity auth login --key <key> accepts key as flag (for CI/automation)"
      ],
      "passes": false,
      "depends_on": [
        "1.1.2",
        "v0.1:1.1.2"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 4,
      "target_version": "v1.0",
      "human_testing": {
        "required": true,
        "instructions": "Test trinity auth login with valid and invalid keys. Verify: prompts correctly, validates against API, saves on success, shows clear errors on failure",
        "url": null
      },
      "tags": [
        "api",
        "auth",
        "claude",
        "cli",
        "testing",
        "validation"
      ]
    },
    {
      "id": "1.1.5",
      "title": "Implement trinity auth logout and status commands",
      "intent": "Allow users to check auth status and logout",
      "acceptance": [
        "trinity auth status shows: logged in/out, license tier, expiration, features",
        "If offline, shows cached info with warning",
        "trinity auth logout removes saved key from ~/.trinity/auth.json",
        "Confirms logout before removing",
        "Shows helpful message after logout"
      ],
      "passes": false,
      "depends_on": [
        "1.1.4"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 5,
      "target_version": "v1.0",
      "tags": [
        "auth",
        "cli"
      ]
    },
    {
      "id": "1.1.6",
      "title": "Integrate license check into run command",
      "intent": "Gate trinity run behind valid license",
      "description": "License check happens early in the run command, before any expensive operations. The --skip-auth flag is for development only—consider hiding it from help output or requiring an environment variable. The inline key prompt is a UX convenience so users don't need to run two commands.",
      "acceptance": [
        "Before trinity run executes, check for valid license",
        "If no saved key, prompt: \"No license found. Run trinity auth login or enter key now:\"",
        "If key invalid/expired, show error and exit",
        "If valid, proceed with run",
        "--skip-auth flag bypasses check (for development/testing only)",
        "Free tier may have limitations (e.g., max stories per day) based on license.features"
      ],
      "passes": false,
      "depends_on": [
        "1.1.3",
        "v0.1:6.3.1"
      ],
      "phase": 1,
      "epic": 1,
      "story_number": 6,
      "target_version": "v1.0",
      "tags": [
        "auth",
        "claude",
        "loop"
      ]
    },
    {
      "id": "2.1.1",
      "title": "Add comprehensive error messages",
      "intent": "Provide helpful error messages for common issues",
      "description": "Good error messages tell users: what went wrong, why, and how to fix it. Create custom error types (ErrClaudeNotFound, ErrGitDirty, etc.) with Error() methods that include the hint. Use errors.Is() and errors.As() for error handling. The consistent format 'Error: X\\nHint: Y' makes errors parseable and scannable.",
      "acceptance": [
        "ErrClaudeNotFound: 'Claude CLI not found. Install from: https://claude.ai/code'",
        "ErrGitDirty: 'Uncommitted changes detected. Run: git stash or git commit'",
        "ErrGitNotRepo: 'Not a git repository. Run: git init'",
        "ErrDBCorrupt: 'Database corrupted. Backup at ~/.trinity/projects/<hash>/trinity.db.bak, then delete trinity.db and re-run'",
        "ErrDBLocked: 'Database locked by another process. Check for running trinity instances'",
        "All errors use consistent format: 'Error: <message>\\nHint: <recovery step>'"
      ],
      "passes": false,
      "depends_on": [
        "v0.1:6.3.1",
        "1.1.6"
      ],
      "phase": 2,
      "epic": 1,
      "story_number": 1,
      "target_version": "v1.0",
      "tags": [
        "claude",
        "db",
        "git",
        "ux"
      ]
    },
    {
      "id": "2.1.2",
      "title": "Add colored terminal output",
      "intent": "Improve CLI readability with colors",
      "description": "fatih/color automatically handles TTY detection—colors are disabled when output is piped or redirected. Create helper functions like ui.Success(), ui.Error(), ui.Warn() that wrap color output. Test in different terminals (iTerm2, VS Code terminal, etc.) to ensure readability.",
      "acceptance": [
        "Uses fatih/color for terminal colors",
        "Success messages in green",
        "Errors in red",
        "Warnings in yellow",
        "Status info in cyan",
        "Colors disabled when not TTY"
      ],
      "passes": false,
      "depends_on": [
        "v0.1:6.3.2",
        "1.1.6"
      ],
      "phase": 2,
      "epic": 1,
      "story_number": 2,
      "human_testing": {
        "required": true,
        "instructions": "Run various trinity commands (status, run, errors). Verify: colors appear correctly in terminal, colors disabled when piped to file, contrast is readable",
        "url": null
      },
      "target_version": "v1.0",
      "tags": [
        "testing",
        "ux"
      ]
    },
    {
      "id": "2.1.3",
      "title": "Add progress spinners",
      "intent": "Show activity during long-running operations",
      "acceptance": [
        "Spinner shown during Claude execution",
        "Spinner for database operations",
        "Clean up on completion or error",
        "Works in quiet mode (no spinner)"
      ],
      "passes": false,
      "depends_on": [
        "2.1.2"
      ],
      "phase": 2,
      "epic": 1,
      "story_number": 3,
      "human_testing": {
        "required": true,
        "instructions": "Run operations that take time (analyze, run). Verify: spinner animates smoothly, cleans up on completion, cleans up on Ctrl+C, disabled in non-TTY",
        "url": null
      },
      "target_version": "v1.0",
      "tags": [
        "claude",
        "db",
        "testing",
        "ux"
      ]
    },
    {
      "id": "2.2.1",
      "title": "Write README with quick start guide",
      "intent": "Help users get started with Trinity",
      "acceptance": [
        "README.md at project root",
        "Installation instructions",
        "Quick start: init -> analyze -> plan add -> run",
        "Links to full documentation"
      ],
      "passes": false,
      "depends_on": [
        "v0.1:6.3.1",
        "1.1.6"
      ],
      "phase": 2,
      "epic": 2,
      "story_number": 1,
      "target_version": "v1.0",
      "tags": [
        "docs"
      ]
    },
    {
      "id": "2.2.2",
      "title": "Add --help for all commands",
      "intent": "Provide inline help for all CLI commands",
      "acceptance": [
        "All commands have Short and Long descriptions",
        "Examples shown in help output",
        "Flags documented with defaults",
        "trinity help <command> works"
      ],
      "passes": false,
      "depends_on": [
        "v0.1:6.3.1",
        "1.1.6"
      ],
      "phase": 2,
      "epic": 2,
      "story_number": 2,
      "target_version": "v1.0",
      "tags": [
        "docs"
      ]
    },
    {
      "id": "2.3.1",
      "title": "End-to-end test on sample project",
      "intent": "Verify complete workflow works",
      "acceptance": [
        "Create test project with simple PRD",
        "Run full init -> plan -> run cycle",
        "Stories complete successfully",
        "PRD updates correctly",
        "No errors in output"
      ],
      "passes": false,
      "depends_on": [
        "2.1.1"
      ],
      "phase": 2,
      "epic": 3,
      "story_number": 1,
      "human_testing": {
        "required": true,
        "instructions": "Run complete workflow on a fresh test project: trinity init, trinity analyze, trinity plan add with simple feature, trinity run. Verify entire flow works end-to-end",
        "url": null
      },
      "target_version": "v1.0",
      "tags": [
        "testing"
      ]
    },
    {
      "id": "2.3.2",
      "title": "Test crash recovery",
      "intent": "Verify recovery from interrupted sessions",
      "acceptance": [
        "Simulate crash during story execution",
        "Restart detects stale agent",
        "Resume option works correctly",
        "Story completes on retry"
      ],
      "passes": false,
      "depends_on": [
        "2.3.1"
      ],
      "phase": 2,
      "epic": 3,
      "story_number": 2,
      "human_testing": {
        "required": true,
        "instructions": "Start trinity run, kill process mid-story (kill -9), restart trinity run. Verify: crash detected, resume prompt appears, can successfully resume or restart story",
        "url": null
      },
      "target_version": "v1.0",
      "tags": [
        "recovery",
        "testing"
      ]
    },
    {
      "id": "2.3.3",
      "title": "Test dependency resolution",
      "intent": "Verify dependency system works correctly",
      "acceptance": [
        "Stories with unmet deps not selected",
        "Completing story unblocks dependents",
        "Phase/epic dependencies resolved",
        "Circular dependency detection"
      ],
      "passes": false,
      "depends_on": [
        "2.3.1"
      ],
      "phase": 2,
      "epic": 3,
      "story_number": 3,
      "human_testing": {
        "required": true,
        "instructions": "Create PRD with complex dependencies (story->story, story->epic, cross-phase). Run and verify: correct execution order, no story runs before deps, completion unblocks correctly",
        "url": null
      },
      "target_version": "v1.0",
      "tags": [
        "testing"
      ]
    },
    {
      "id": "3.1.1",
      "title": "Final human testing and v1.0 sign-off",
      "intent": "Comprehensive manual validation before release - wraps all loose ends",
      "description": "This is the gatekeeper story—nothing ships without passing this. Test on a fresh machine if possible (or clean environment). Document any issues found. The human_testing instructions are comprehensive; follow them step by step. Only mark this complete when confident Trinity is ready for public use.",
      "acceptance": [
        "Complete workflow test: init → analyze → plan add → run → release",
        "Multi-story execution with dependencies works correctly",
        "Human approval gates (approve/reject) function properly",
        "PR feedback loop (trinity pr feedback) allows iteration",
        "Story validation with [c]larify and [a]uto-proceed options works",
        "Feedback at run checkpoints (PR create, update, merge) allows iteration",
        "Blocked state display shows unmerged PRs and blocked stories",
        "External dependency validation prompts for report before stories with external_deps",
        "Release workflow with human gate completes successfully",
        "Hotfix flow works for quick fixes",
        "Error handling shows helpful messages",
        "Crash recovery and resume work as expected",
        "README quick start works for new users",
        "All --help output is accurate and helpful",
        "No critical bugs or UX issues remain",
        "Ready for v1.0 release"
      ],
      "passes": false,
      "depends_on": [
        "2",
        "v0.1:1.1.3",
        "v0.1:1.2.3",
        "v0.1:6.4.4",
        "v0.1:2.2.2",
        "v0.1:3.1.5",
        "v0.1:3.1.6",
        "v0.1:4.2.1",
        "v0.1:4.2.6",
        "v0.1:4.2.8",
        "v0.1:4.3.1",
        "v0.1:4.3.2",
        "v0.1:4.3.3",
        "v0.1:4.3.4",
        "v0.1:5.1.2",
        "v0.1:5.1.7",
        "v0.1:5.1.8",
        "v0.1:5.2.3",
        "v0.1:6.2.3",
        "v0.1:6.2.4",
        "v0.1:6.4.2",
        "v0.1:6.4.3",
        "v0.1:6.3.3",
        "v0.1:6.5.1",
        "v0.1:6.5.2",
        "v0.1:6.5.3",
        "v0.1:6.5.4",
        "v0.1:6.5.5",
        "v0.1:6.6.2",
        "v0.1:6.7.1",
        "v0.1:6.7.2",
        "v0.1:6.7.3",
        "v0.1:6.8.2",
        "v0.1:6.8.3",
        "2.1.3",
        "2.2.1",
        "2.2.2",
        "2.3.2",
        "2.3.3",
        "1.1.6"
      ],
      "phase": 3,
      "epic": 1,
      "story_number": 1,
      "target_version": "v1.0",
      "human_testing": {
        "required": true,
        "instructions": "Run through complete workflow on fresh project. Test all major features: init, analyze, plan, run, approve/reject, pr feedback, release, hotfix. Document any issues. Sign off when ready for v1.0.",
        "url": null
      },
      "tags": [
        "claude",
        "testing",
        "validation"
      ]
    }
  ]
}
