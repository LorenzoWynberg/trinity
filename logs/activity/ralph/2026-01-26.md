# Ralph Activity Log - 2026-01-26

## Dashboard: Cyber Theme Refinements & UI Improvements

**Time:** 2026-01-26 ~15:00 CR

### What was done

Major refinements to cyber-light and cyber-dark themes with improved color semantics and UI consistency.

**Cyber-light theme updates:**
- Swapped primary/accent: cyan is now primary, pink is accent
- Yellow as secondary accent color
- High contrast hover states on buttons (full cyan bg, white text)
- Pink titles, cyan subtitles throughout
- Cyan borders on cards, tabs, dropdowns
- Sidebar active state uses accent (pink)

**Cyber-dark theme updates:**
- Outline buttons: cyan border/text, pink hover with dark text (matches nav)
- Dropdowns use theme border color (matches cards)
- Split buttons have cyan text, pink hover

**New SplitButton component:**
- Icon section (white bg, pink icon) stays same on hover
- Text section goes cyan bg with white text on hover
- Yellow outer border on hover
- Different behavior for cyber-dark (no split, just cyan to pink transition)

**Other improvements:**
- Dead ends toggle uses accent color (pink in cyber-light, cyan in cyber-dark)
- Story cards have left cyan border accent, pink title, cyan phase info
- Command reference modal: click shows dropdown to copy full command or flag only
- Terminal padding fixed (p-3 on container)

### Files created

- `src/components/ui/split-button.tsx` - New split button component

### Files modified

- `src/app/globals.css` - Cyber-light theme color variable swap
- `src/app/graph/page.tsx` - Dead ends uses accent color
- `src/components/ui/button.tsx` - Cyber theme outline button styles
- `src/components/ui/card.tsx` - Cyber-light cyan border
- `src/components/ui/tabs.tsx` - Cyber-light cyan border
- `src/components/ui/select.tsx` - Cyber theme borders
- `src/components/sidebar.tsx` - Cyber-light accent for active/hover
- `src/components/story-card.tsx` - Cyber-light colored accents
- `src/components/story-node.tsx` - Pending status cyan border, accent dead end indicator
- `src/components/version-node.tsx` - Cyan border and progress bar
- `src/components/blocked-stories.tsx` - Yellow border override for cyber-light
- `src/components/stories-header.tsx` - Uses new SplitButton
- `src/components/terminal-view.tsx` - Added padding to terminal container
- `src/components/command-reference.tsx` - Copy dropdown (full command or flag)
- `src/app/activity/activity-client.tsx` - Cyan border on project selector

---

## Documentation: Separate Knowledge Base and Gotchas

**Time:** 2026-01-26 ~15:45 CR

### What was done

Reorganized documentation from single `docs/learnings/` folder into two distinct folders with clear purposes:

**Created `docs/knowledge/`** - Product documentation:
- `README.md` - Index and structure overview
- `ralph.md` - Ralph CLI commands, workflow, state management, PRD features
- `dashboard.md` - Dashboard architecture, terminal, themes, ngrok setup
- `go.md` - Go workspace setup, multi-module patterns

**Renamed `docs/learnings/` to `docs/gotchas/`** - Pitfalls to avoid:
- Updated `README.md` with new purpose description
- Created `dashboard.md` - React/Next.js hydration, mobile issues, shadcn quirks
- Kept `elvish.md` - Already pure gotchas (unchanged)
- Simplified `go.md` - Kept only gotcha content
- Deleted `ralph.md` - Content split to knowledge/ and gotchas/dashboard.md

**Updated dashboard:**
- Added `getKnowledge()` and renamed `getLearnings()` to `getGotchas()` in data.ts
- Created new `/knowledge` page with DocsTabs component
- Renamed `/learnings` to `/gotchas` page
- Added Knowledge (BookOpen icon) and Gotchas (AlertTriangle icon) to sidebar
- Created generic `docs-tabs.tsx` component for both pages

**Updated Ralph CLI:**
- Renamed `lib/learnings.elv` to `lib/gotchas.elv`
- Updated all module imports (ralph.elv, claude.elv)
- Updated all function calls from `learnings:` to `gotchas:`
- Updated extraction to output `<gotcha>` tags instead of `<learning>`
- Updated file list: dashboard.md, elvish.md, go.md, patterns.md, conventions.md

**Updated Claude instructions:**
- `instructions/context.md` - New doc paths table
- `instructions/gotchas.md` (renamed from learnings.md) - Updated file list
- `instructions/completion.md` - Updated references
- `prompts/partials/workflow.md` - Updated doc paths and references

### Files created

- `docs/knowledge/README.md`
- `docs/knowledge/ralph.md`
- `docs/knowledge/dashboard.md`
- `docs/knowledge/go.md`
- `docs/gotchas/dashboard.md`
- `src/app/knowledge/page.tsx`
- `src/components/docs-tabs.tsx`

### Files renamed

- `docs/learnings/` -> `docs/gotchas/`
- `src/app/learnings/` -> `src/app/gotchas/`
- `cli/lib/learnings.elv` -> `cli/lib/gotchas.elv`
- `cli/instructions/learnings.md` -> `cli/instructions/gotchas.md`

### Files modified

- `docs/gotchas/README.md` - Updated purpose
- `docs/gotchas/go.md` - Kept only gotcha content
- `src/lib/data.ts` - Added getKnowledge(), renamed getLearnings() to getGotchas()
- `src/app/gotchas/page.tsx` - Use getGotchas(), updated title/description
- `src/components/sidebar.tsx` - Added Knowledge and Gotchas nav items
- `cli/ralph.elv` - Import and call gotchas module
- `cli/lib/claude.elv` - Import and call gotchas module
- `cli/lib/gotchas.elv` - Updated all references
- `cli/instructions/context.md` - New doc paths
- `cli/instructions/gotchas.md` - Updated file list
- `cli/instructions/completion.md` - Updated references
- `cli/prompts/partials/workflow.md` - Updated doc paths

### Files deleted

- `docs/gotchas/ralph.md` (content split to knowledge/)
- `src/components/learnings-tabs.tsx` (replaced by docs-tabs.tsx)

---

## Ralph: Add Knowledge Base Auto-Extraction

**Time:** 2026-01-26 ~16:15 CR

### What was done

Extended the extraction system to also capture knowledge/documentation updates alongside gotchas.

**Extraction changes:**
- Now extracts both `<knowledge>` and `<gotcha>` tags
- Knowledge targets: `ralph.md`, `dashboard.md`, `go.md`
- Gotcha targets: `dashboard.md`, `elvish.md`, `go.md`, `patterns.md`, `conventions.md`
- Prompt asks Claude to differentiate:
  - Knowledge = new features, workflows, behaviors (how things work)
  - Gotchas = mistakes, surprises, pitfalls (what to avoid)

**Monthly restructuring:**
- Knowledge files get restructured (not compacted) after 30 days
- Focus on logical flow, grouping, headers - NOT content reduction
- Gotchas still get compacted (merged, reduced)

**Files modified:**
- `cli/lib/gotchas.elv`:
  - Updated `extract` to parse both `<knowledge>` and `<gotcha>` tags
  - Added `mark-updated` for knowledge files
  - Updated `compact-file` to accept type parameter ("knowledge" vs "gotchas")
  - Knowledge uses restructuring prompt (preserve all, reorganize)
  - Gotchas uses compaction prompt (reduce redundancy)
  - Updated `check-and-compact` to check both directories
  - Updated `init-all-metadata` to initialize both directories
  - Made file lists dynamic - reads from directory contents instead of hardcoded arrays
  - Added `trinity.md` to knowledge base

**Dynamic file discovery:**
- Lists actual .md files in each directory (excluding README.md)
- Builds "Existing files:" string from directory contents
- Prompt tells Claude it can create NEW files if topic deserves its own file
- Parsing extracts filenames from tags (not from predefined list)
- Validates filenames (must end in .md, no path traversal)
- Auto-creates new files with title header when needed

---

## Dashboard: Knowledge Base Chapter Structure

**Time:** 2026-01-26 ~18:40 CR

### What was done

Transformed the flat knowledge base and gotchas pages into hierarchical chapter-based systems.

**Folder structure:**
- Each "book" is a folder (ralph/, trinity/, dashboard/, go/, etc.)
- Each folder has `index.json` for metadata and page ordering
- Pages are markdown files within the folder
- `index.json` defines title, description, icon, and page order

**Example structure:**
```
docs/knowledge/ralph/
├── index.json           # { title, icon, pages: [...] }
├── index.md             # Overview page
├── common-workflows.md  # Workflows page
├── cli-reference.md     # CLI Reference page
└── faq.md               # FAQ page
```

**UI changes:**
- Replaced tabs with two side-by-side dropdowns
- Book dropdown (left): Select which book (Ralph, Dashboard, etc.)
- Chapter dropdown (right): Select page within the book
- URL params: `?book=ralph&chapter=cli-reference`
- Works for both Knowledge Base and Gotchas pages

**Types added (`src/lib/types.ts`):**
- `ChapterPageMeta` - slug and title for page navigation
- `ChapterIndex` - chapter metadata (title, description, icon, pages)
- `KnowledgePage` - page content with slug, title, markdown
- `KnowledgeChapter` - folder structure with slug, index, pages

**Data functions (`src/lib/data.ts`):**
- `getChaptersFromDir()` - shared helper to read chapter folders
- `getKnowledgeChapters()` - reads from docs/knowledge/
- `getGotchasChapters()` - reads from docs/gotchas/

**Ralph book split into 4 pages:**
- Overview (quick start, how it works)
- Workflows (common workflows, validation, PR flow, release)
- CLI Reference (all flag tables)
- FAQ (common questions)

### Files created

- `src/components/chapter-nav.tsx` - Book/chapter dropdown navigation
- `docs/knowledge/ralph/index.json`
- `docs/knowledge/ralph/common-workflows.md`
- `docs/knowledge/ralph/cli-reference.md`
- `docs/knowledge/ralph/faq.md`
- `docs/knowledge/trinity/index.json`
- `docs/knowledge/dashboard/index.json`
- `docs/knowledge/go/index.json`
- `docs/gotchas/elvish/index.json`
- `docs/gotchas/dashboard/index.json`
- `docs/gotchas/go/index.json`
- `docs/gotchas/conventions/index.json`
- `docs/gotchas/patterns/index.json`

### Files modified

- `src/lib/types.ts` - Added chapter types
- `src/lib/data.ts` - Added chapter reading functions
- `src/app/knowledge/page.tsx` - Use ChapterNav component
- `src/app/gotchas/page.tsx` - Use ChapterNav component

### Files moved

- `docs/knowledge/*.md` → `docs/knowledge/*/index.md`
- `docs/gotchas/*.md` → `docs/gotchas/*/index.md`

### Follow-up tweak

- Chapter dropdown hidden when book has only one page (cleaner UX)

---

## Ralph: Update Prompts for New Docs Structure

**Time:** 2026-01-26 ~19:00 CR

### What was done

Updated Ralph's instructions and prompts to reflect the new book/chapter documentation structure.

**Changes:**
- Updated `instructions/context.md` with new doc paths (book/chapter format)
- Rewrote `instructions/gotchas.md` to explain folder structure and how to add chapters
- Added task tracking guideline to `instructions/implementation.md`
- Updated `prompts/partials/workflow.md`:
  - New doc paths for knowledge and gotchas
  - Documentation loop includes adding chapters
  - Task tracking guideline for non-trivial work
  - Updated success/blocked sections with book paths

### Files modified

- `tools/ralph/cli/instructions/context.md`
- `tools/ralph/cli/instructions/gotchas.md`
- `tools/ralph/cli/instructions/implementation.md`
- `tools/ralph/cli/prompts/partials/workflow.md`

---

## Docs: Unify Knowledge and Gotchas Structure

**Time:** 2026-01-26 ~19:20 CR

### What was done

Simplified documentation by using the same book/chapter structure for both Knowledge and Gotchas.

**Key decision:** Both Knowledge and Gotchas use identical structure:
```
docs/<knowledge|gotchas>/<book>/
├── index.json       # { title, icon, pages: [...] }
├── index.md         # Overview (required)
└── <chapter>.md     # Additional chapters (optional)
```

Chapter dropdown only appears when a book has multiple pages. This means:
- Same code handles both (ChapterNav component)
- Ralph learns one pattern, not two
- Either can grow chapters as needed without refactoring

**Updated:**
- Ralph instructions (context.md, gotchas.md) - unified structure explanation
- Dashboard knowledge - reflects same structure for both
- Removed "gotchas is flat" distinction - it's the same system

### Files modified

- `tools/ralph/cli/instructions/context.md` - unified structure note
- `tools/ralph/cli/instructions/gotchas.md` - same structure for both
- `docs/knowledge/dashboard/index.md` - documentation structure section
