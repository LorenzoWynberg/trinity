# Ralph Activity Log - 2026-01-28

## Fix: Dashboard Refine Endpoint Timeout

**Time:** 2026-01-28 ~05:30 SAST

### Problem

The `/api/prd/refine` endpoint was failing with:
```
Signal: SIGTERM
Killed: true
POST /api/prd/refine 500 in 2.0min
```

The endpoint was timing out after the default 2-minute timeout when trying to analyze 91 stories. The `/api/prd/story` endpoint worked fine because it only handles one story at a time.

### Root Cause

The `runClaude()` helper has a default timeout of 120000ms (2 minutes). Analyzing all pending stories takes longer than this, causing Node.js to kill the Claude process with SIGTERM.

### Solution

1. Increased refine endpoint timeout to 10 minutes (600000ms)
2. Added debug logging to `runClaude()` and refine route for future diagnosis:
   - Request ID, file paths, CWD, prompt length
   - On error: exit code, signal, killed status, stdout/stderr

### Files modified

- `tools/ralph/dashboard/src/app/api/prd/refine/route.ts` - Added timeout option and debug logging
- `tools/ralph/dashboard/src/lib/claude.ts` - Added debug logging for Claude execution
- `docs/knowledge/ralph-dashboard/prd-tools.md` - Added Timeouts section documenting limits

### Commit

`8b3557f` - fix(dashboard): increase refine timeout to 10 minutes and add debug logging

---

## Refactor: Standardize Claude timeout to 15 minutes

**Time:** 2026-01-28 ~05:35 SAST

### What was done

Changed all Claude CLI calls to use a consistent 15-minute timeout instead of varying timeouts per endpoint.

### Changes

- Set default timeout in `runClaude()` to 900000ms (15 minutes)
- Removed all per-endpoint timeout overrides - they now use the default
- Updated prd-tools.md documentation

### Files modified

- `tools/ralph/dashboard/src/lib/claude.ts` - Default timeout now 15 min
- `tools/ralph/dashboard/src/app/api/prd/refine/route.ts` - Removed timeout overrides
- `tools/ralph/dashboard/src/app/api/prd/refine/edit/route.ts` - Removed timeout override
- `tools/ralph/dashboard/src/app/api/prd/story/route.ts` - Removed timeout override
- `tools/ralph/dashboard/src/app/api/prd/generate/route.ts` - Removed timeout override
- `docs/knowledge/ralph-dashboard/prd-tools.md` - Updated timeout docs

---
