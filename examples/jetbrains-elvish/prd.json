{
  "stories": [
    {
      "id": "STORY-1.1.1",
      "title": "Create Gradle project structure",
      "intent": "Establish the foundational directory structure for a JetBrains plugin project with proper Gradle configuration",
      "acceptance": [
        "Project has standard Gradle directory layout (src/main/kotlin, src/main/resources)",
        "settings.gradle.kts defines project name as 'jetbrains-elvish'",
        "gradle.properties contains plugin metadata (group, version, platform settings)",
        "Gradle wrapper configured and working"
      ],
      "passes": true,
      "depends_on": [],
      "phase": 1,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-1.1.2",
      "title": "Configure build.gradle.kts for IntelliJ plugin",
      "intent": "Set up Gradle build configuration with IntelliJ Platform Plugin SDK and required dependencies",
      "acceptance": [
        "build.gradle.kts uses org.jetbrains.intellij.platform plugin",
        "Kotlin JVM plugin configured with version 1.9.25",
        "Java 21 toolchain configured",
        "IntelliJ Ultimate 2024.3 target platform set",
        "Build range configured (243 to 251.*)",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-1.1.1"],
      "phase": 1,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-1.1.3",
      "title": "Create base plugin.xml manifest",
      "intent": "Define the plugin manifest with basic metadata and module dependencies",
      "acceptance": [
        "plugin.xml in src/main/resources/META-INF/",
        "Plugin ID set to com.elvish.plugin",
        "Dependencies on com.intellij.modules.platform and com.intellij.modules.ultimate declared",
        "Basic plugin metadata (name, vendor, description) configured"
      ],
      "passes": true,
      "depends_on": ["STORY-1.1.1"],
      "phase": 1,
      "epic": 1,
      "story_number": 3
    },
    {
      "id": "STORY-2.1.1",
      "title": "Create ElvishLanguage class",
      "intent": "Define the Elvish language singleton required by IntelliJ's language support infrastructure",
      "acceptance": [
        "ElvishLanguage.kt extends com.intellij.lang.Language",
        "Singleton pattern with companion object INSTANCE",
        "Language ID is 'Elvish'",
        "Class compiles without errors"
      ],
      "passes": true,
      "depends_on": ["STORY-1.1.2"],
      "phase": 2,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-2.1.2",
      "title": "Create ElvishFileType class",
      "intent": "Register .elv file extension with the IDE and associate it with the Elvish language",
      "acceptance": [
        "ElvishFileType.kt extends LanguageFileType",
        "Object singleton pattern used",
        "Associates .elv extension with ElvishLanguage",
        "Returns appropriate name, description, and icon",
        "Registered in plugin.xml as fileType extension"
      ],
      "passes": true,
      "depends_on": ["STORY-2.1.1"],
      "phase": 2,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-2.1.3",
      "title": "Create ElvishIcons and SVG icon",
      "intent": "Provide visual branding with a custom SVG icon for Elvish files",
      "acceptance": [
        "elvish.svg icon created in src/main/resources/icons/",
        "Icon uses Material Palenight color scheme",
        "ElvishIcons.kt loads icon using IconLoader",
        "Icon displays correctly in file tree and tabs"
      ],
      "passes": true,
      "depends_on": ["STORY-1.1.2"],
      "phase": 2,
      "epic": 1,
      "story_number": 3
    },
    {
      "id": "STORY-2.1.4",
      "title": "Create ElvishFile PSI wrapper",
      "intent": "Provide the PSI file implementation required by IntelliJ's PSI infrastructure",
      "acceptance": [
        "ElvishFile.kt extends PsiFileBase",
        "Associates file with ElvishLanguage and ElvishFileType",
        "Provides proper toString representation",
        "./gradlew build succeeds with all Phase 2 components"
      ],
      "passes": true,
      "depends_on": ["STORY-2.1.2"],
      "phase": 2,
      "epic": 1,
      "story_number": 4
    },
    {
      "id": "STORY-3.1.1",
      "title": "Create ElvishLspServerSupportProvider",
      "intent": "Implement the LSP server support provider that triggers server startup when .elv files are opened",
      "acceptance": [
        "ElvishLspServerSupportProvider.kt implements LspServerSupportProvider",
        "fileOpened method checks for .elv extension",
        "Calls serverStarter.ensureServerStarted with descriptor",
        "Registered in plugin.xml as platform.lsp.serverSupportProvider"
      ],
      "passes": true,
      "depends_on": ["STORY-2.1.4"],
      "phase": 3,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-3.1.2",
      "title": "Create ElvishLspServerDescriptor",
      "intent": "Configure the LSP server descriptor that defines how to launch and communicate with elvish -lsp",
      "acceptance": [
        "ElvishLspServerDescriptor.kt extends ProjectWideLspServerDescriptor",
        "createCommandLine returns GeneralCommandLine('elvish', '-lsp')",
        "isSupportedFile filters for .elv extension",
        "Project-wide scope (single server per project)",
        "./gradlew build succeeds",
        "LSP server starts when opening .elv file in runIde"
      ],
      "passes": true,
      "depends_on": ["STORY-3.1.1"],
      "phase": 3,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-4.1.1",
      "title": "Create TextMate grammar file for Elvish syntax",
      "intent": "Define comprehensive TextMate grammar patterns for Elvish syntax highlighting with Material Palenight color mapping",
      "acceptance": [
        "elvish.tmLanguage.json created in src/main/resources/textmate/",
        "Patterns for comments (#), strings (single and double quoted)",
        "Patterns for keywords (if, elif, else, while, for, try, fn, var, set, etc.)",
        "Patterns for built-in functions (put, echo, each, map, etc.)",
        "Patterns for variables ($var, $@var)",
        "Patterns for numbers (int, float, hex, octal, binary)",
        "Patterns for operators (|, <, >, ==, etc.)",
        "Patterns for constants ($true, $false, $nil)",
        "JSON syntax is valid"
      ],
      "passes": true,
      "depends_on": ["STORY-3.1.2"],
      "phase": 4,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-4.1.2",
      "title": "Create ElvishTextMateBundleProvider",
      "intent": "Implement the TextMate bundle provider that registers the Elvish grammar with the IDE",
      "acceptance": [
        "ElvishTextMateBundleProvider.kt implements TextMateBundleProvider",
        "getBundles returns list with Elvish TextMateBundle",
        "Bundle points to /textmate/elvish.tmLanguage.json resource",
        "Class compiles without errors"
      ],
      "passes": true,
      "depends_on": ["STORY-4.1.1"],
      "phase": 4,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-4.1.3",
      "title": "Register TextMate bundle in plugin.xml",
      "intent": "Add the TextMate bundle provider extension to the plugin manifest",
      "acceptance": [
        "textmate.bundleProvider extension added to plugin.xml",
        "Extension points to ElvishTextMateBundleProvider implementation",
        "Plugin depends on org.jetbrains.plugins.textmate (or bundled equivalent)",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-4.1.2"],
      "phase": 4,
      "epic": 1,
      "story_number": 3
    },
    {
      "id": "STORY-4.1.4",
      "title": "Test and verify syntax highlighting",
      "intent": "Verify that syntax highlighting works correctly for all Elvish language constructs",
      "acceptance": [
        "./gradlew runIde launches successfully",
        "Create test .elv file with various syntax elements",
        "Comments appear in gray (#676E95)",
        "Keywords appear in purple (#C792EA)",
        "Strings appear in green (#C3E88D)",
        "Numbers appear in orange (#F78C6C)",
        "Built-in functions appear in blue (#82AAFF)",
        "Variables appear in yellow (#FFCB6B)",
        "No errors in IDE logs related to TextMate grammar"
      ],
      "passes": true,
      "depends_on": ["STORY-4.1.3"],
      "phase": 4,
      "epic": 1,
      "story_number": 4
    },
    {
      "id": "STORY-5.1.1",
      "title": "Create ElvishTokenTypes",
      "intent": "Define token types for the Elvish lexer to categorize lexical elements",
      "acceptance": [
        "ElvishTokenTypes.kt created with IElementType definitions",
        "Token types for: COMMENT, STRING, NUMBER, KEYWORD, IDENTIFIER, OPERATOR, etc.",
        "TokenSets defined for comments and string literals",
        "All types use ElvishLanguage.INSTANCE"
      ],
      "passes": true,
      "depends_on": ["STORY-4.1.4"],
      "phase": 5,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-5.1.2",
      "title": "Create ElvishLexer",
      "intent": "Implement a basic lexer that tokenizes Elvish source code",
      "acceptance": [
        "ElvishLexer.kt extends LexerBase or uses FlexLexer",
        "Recognizes comments starting with #",
        "Recognizes single and double quoted strings",
        "Recognizes keywords and identifiers",
        "Recognizes numbers (int, float)",
        "Recognizes operators and punctuation",
        "Unit tests verify token sequences"
      ],
      "passes": true,
      "depends_on": ["STORY-5.1.1"],
      "phase": 5,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-5.1.3",
      "title": "Create ElvishParser",
      "intent": "Implement a minimal parser for basic AST structure",
      "acceptance": [
        "ElvishParser.kt implements PsiParser",
        "Creates basic AST structure from token stream",
        "Handles statements and expressions at high level",
        "Error recovery for malformed input",
        "Unit tests verify AST structure"
      ],
      "passes": true,
      "depends_on": ["STORY-5.1.2"],
      "phase": 5,
      "epic": 1,
      "story_number": 3
    },
    {
      "id": "STORY-5.1.4",
      "title": "Create ElvishParserDefinition",
      "intent": "Implement the parser definition that ties together lexer, parser, and file creation",
      "acceptance": [
        "ElvishParserDefinition.kt implements ParserDefinition",
        "createLexer returns ElvishLexer",
        "createParser returns ElvishParser",
        "getFileNodeType returns proper IFileElementType",
        "createFile returns ElvishFile",
        "getCommentTokens and getStringLiteralElements return proper TokenSets"
      ],
      "passes": true,
      "depends_on": ["STORY-5.1.3"],
      "phase": 5,
      "epic": 1,
      "story_number": 4
    },
    {
      "id": "STORY-5.1.5",
      "title": "Register parser in plugin.xml",
      "intent": "Add the parser definition extension to enable custom parsing",
      "acceptance": [
        "lang.parserDefinition extension added to plugin.xml",
        "Extension associates ElvishParserDefinition with Elvish language",
        "./gradlew build succeeds",
        "./gradlew runIde works without parser errors"
      ],
      "passes": true,
      "depends_on": ["STORY-5.1.4"],
      "phase": 5,
      "epic": 1,
      "story_number": 5
    },
    {
      "id": "STORY-6.1.1",
      "title": "Create ElvishSettings persistent state",
      "intent": "Implement project-level settings storage for Elvish plugin configuration",
      "acceptance": [
        "ElvishSettings.kt created in settings package",
        "Uses @State and @Service annotations",
        "Implements PersistentStateComponent<State>",
        "State data class with elvishPath property (default: 'elvish')",
        "Settings stored in elvish.xml",
        "getInstance companion method for accessing settings"
      ],
      "passes": true,
      "depends_on": ["STORY-4.1.4"],
      "phase": 6,
      "epic": 1,
      "story_number": 1
    },
    {
      "id": "STORY-6.1.2",
      "title": "Create ElvishConfigurable settings UI",
      "intent": "Provide a settings panel for users to configure the Elvish executable path",
      "acceptance": [
        "ElvishConfigurable.kt implements Configurable",
        "createComponent builds UI with Kotlin UI DSL",
        "Text field with file browser for elvish path",
        "isModified correctly detects changes",
        "apply saves changes to ElvishSettings",
        "reset restores settings from storage"
      ],
      "passes": true,
      "depends_on": ["STORY-6.1.1"],
      "phase": 6,
      "epic": 1,
      "story_number": 2
    },
    {
      "id": "STORY-6.1.3",
      "title": "Update LSP descriptor to use settings",
      "intent": "Modify the LSP server descriptor to read the elvish path from settings instead of hardcoding",
      "acceptance": [
        "ElvishLspServerDescriptor reads elvish path from ElvishSettings",
        "Falls back to 'elvish' if settings not configured",
        "createCommandLine uses configured path",
        "LSP server restarts when settings change (or requires IDE restart)"
      ],
      "passes": true,
      "depends_on": ["STORY-6.1.2"],
      "phase": 6,
      "epic": 1,
      "story_number": 3
    },
    {
      "id": "STORY-6.1.4",
      "title": "Register settings in plugin.xml",
      "intent": "Add the settings configurable extension to make settings accessible from IDE preferences",
      "acceptance": [
        "projectConfigurable extension added to plugin.xml",
        "Settings appear under Languages & Frameworks > Elvish",
        "displayName is 'Elvish'",
        "instance attribute points to ElvishConfigurable",
        "./gradlew build succeeds",
        "Settings panel accessible in runIde"
      ],
      "passes": true,
      "depends_on": ["STORY-6.1.3"],
      "phase": 6,
      "epic": 1,
      "story_number": 4
    },
    {
      "id": "STORY-1.2.1",
      "title": "Fix LSP module dependency for cross-IDE support",
      "intent": "Change from com.intellij.modules.lsp to com.intellij.modules.ultimate for 2024.x compatibility",
      "acceptance": [
        "plugin.xml uses com.intellij.modules.ultimate for LSP dependency",
        "LSP dependency remains optional with config-file attribute",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.1.4"],
      "phase": 1,
      "epic": 2,
      "story_number": 1
    },
    {
      "id": "STORY-1.2.2",
      "title": "Update minimum IDE version to 2024.3",
      "intent": "Set sinceBuild to 243 to ensure stable LSP API availability across all JetBrains IDEs",
      "acceptance": [
        "build.gradle.kts sinceBuild set to 243",
        "untilBuild allows future versions (no hard cap or high cap)",
        "./gradlew build succeeds",
        "Plugin verification passes"
      ],
      "passes": true,
      "depends_on": ["STORY-1.2.1"],
      "phase": 1,
      "epic": 2,
      "story_number": 2
    },
    {
      "id": "STORY-1.2.3",
      "title": "Add LSP server startup logging",
      "intent": "Add debug logging to LSP provider to diagnose server startup issues",
      "acceptance": [
        "ElvishLspServerSupportProvider logs when fileOpened is called",
        "Logs include file path and whether LSP is starting",
        "ElvishLspServerDescriptor logs command line being executed",
        "Logs visible in IDE log (Help > Show Log)",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-1.2.1"],
      "phase": 1,
      "epic": 2,
      "story_number": 3
    },
    {
      "id": "STORY-2.2.1",
      "title": "Verify LSP server process starts",
      "intent": "Confirm that elvish -lsp process actually starts when opening .elv files",
      "acceptance": [
        "./gradlew runIde launches successfully",
        "Open any .elv file in sandbox IDE",
        "Verify elvish -lsp process appears in system process list",
        "IDE logs show LSP server started message",
        "No LSP-related errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-1.2.3"],
      "phase": 2,
      "epic": 2,
      "story_number": 1
    },
    {
      "id": "STORY-2.2.2",
      "title": "Test LSP code completion",
      "intent": "Verify that LSP-powered code completion works for Elvish",
      "acceptance": [
        "Type $ in .elv file - variable completion appears",
        "Type partial command name - completion suggestions appear",
        "Type module: (e.g., str:) - module function completions appear",
        "Completion popup shows function signatures where available"
      ],
      "passes": true,
      "depends_on": ["STORY-2.2.1"],
      "phase": 2,
      "epic": 2,
      "story_number": 2
    },
    {
      "id": "STORY-2.2.3",
      "title": "Test LSP hover documentation",
      "intent": "Verify that hovering over functions shows documentation",
      "acceptance": [
        "Hover over built-in function (e.g., echo, put) shows documentation",
        "Hover over variable shows type information if available",
        "Hover popup appears within reasonable time (<1 second)"
      ],
      "passes": true,
      "depends_on": ["STORY-2.2.1"],
      "phase": 2,
      "epic": 2,
      "story_number": 3
    },
    {
      "id": "STORY-2.2.4",
      "title": "Test LSP diagnostics",
      "intent": "Verify that syntax errors are reported by the LSP",
      "acceptance": [
        "Introduce syntax error (e.g., unclosed brace) - error highlighting appears",
        "Error message shown in editor gutter or tooltip",
        "Fix error - highlighting disappears",
        "Diagnostics update in real-time as you type"
      ],
      "passes": true,
      "depends_on": ["STORY-2.2.1"],
      "phase": 2,
      "epic": 2,
      "story_number": 4
    },
    {
      "id": "STORY-3.2.1",
      "title": "Add error handling for missing Elvish binary",
      "intent": "Show clear error message when elvish is not installed or not in PATH",
      "acceptance": [
        "If elvish binary not found, show notification to user",
        "Notification suggests installing Elvish or configuring path in settings",
        "Plugin doesn't crash or spam errors when Elvish missing",
        "LSP gracefully disabled until Elvish available"
      ],
      "passes": true,
      "depends_on": ["STORY-2.2.1"],
      "phase": 3,
      "epic": 2,
      "story_number": 1
    },
    {
      "id": "STORY-3.2.2",
      "title": "Update documentation for cross-IDE support",
      "intent": "Update all documentation to reflect cross-IDE compatibility",
      "acceptance": [
        "README.md lists all supported JetBrains IDEs",
        "README.md clarifies LSP is free for all users (2024.3+)",
        "docs/DEVELOPMENT.md updated with correct module dependency info",
        "CHANGELOG.md documents the cross-IDE fix"
      ],
      "passes": true,
      "depends_on": ["STORY-2.2.4"],
      "phase": 3,
      "epic": 2,
      "story_number": 2
    },
    {
      "id": "STORY-3.2.3",
      "title": "Prepare for marketplace submission",
      "intent": "Ensure plugin meets JetBrains Marketplace requirements",
      "acceptance": [
        "Plugin description is clear and complete",
        "Plugin icon (pluginIcon.svg) meets marketplace guidelines",
        "Vendor information is correct",
        "./gradlew buildPlugin produces valid ZIP",
        "Plugin passes JetBrains Plugin Verifier"
      ],
      "passes": true,
      "depends_on": ["STORY-3.2.2"],
      "phase": 3,
      "epic": 2,
      "story_number": 3
    },
    {
      "id": "STORY-4.3.1",
      "title": "Implement Commenter for line comments",
      "intent": "Enable Ctrl+/ (Cmd+/ on Mac) to toggle line comments using # prefix",
      "acceptance": [
        "Create ElvishCommenter implementing com.intellij.lang.Commenter interface",
        "getLineCommentPrefix() returns '# ' (Elvish uses # for comments, space for readability)",
        "getBlockCommentPrefix() and getBlockCommentSuffix() return null (Elvish has no block comments)",
        "Register commenter in plugin.xml with lang.commenter extension point",
        "Pressing Ctrl+/ on a line adds '# ' prefix",
        "Pressing Ctrl+/ on a commented line removes '# ' prefix",
        "Multi-line selection comments/uncomments all selected lines",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-3.2.3"],
      "phase": 4,
      "epic": 3,
      "story_number": 1
    },
    {
      "id": "STORY-4.3.2",
      "title": "Implement Brace Matching",
      "intent": "Highlight matching braces, brackets, and parentheses when cursor is adjacent",
      "acceptance": [
        "Create ElvishBraceMatcher implementing com.intellij.lang.PairedBraceMatcher",
        "Define BracePair for curly braces: { } (structural, used for functions/blocks)",
        "Define BracePair for square brackets: [ ] (used for lists and maps)",
        "Define BracePair for parentheses: ( ) (used for output capture)",
        "Register in plugin.xml with lang.braceMatcher extension point",
        "When cursor is next to {, matching } is highlighted",
        "When cursor is next to [, matching ] is highlighted",
        "When cursor is next to (, matching ) is highlighted",
        "Unmatched braces show error highlighting",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-4.3.1"],
      "phase": 4,
      "epic": 3,
      "story_number": 2
    },
    {
      "id": "STORY-4.3.3",
      "title": "Implement Code Folding",
      "intent": "Allow collapsing function bodies, blocks, and multi-line constructs",
      "acceptance": [
        "Create ElvishFoldingBuilder implementing com.intellij.lang.folding.FoldingBuilderEx",
        "Fold function definitions: fn name {|args| ... } shows as 'fn name {...}'",
        "Fold lambda expressions: {|args| ... } shows as '{...}'",
        "Fold if/for/while/try blocks",
        "Fold multi-line lists: [a b c] across lines can be collapsed",
        "Fold multi-line maps: [&key=value ...] can be collapsed",
        "Register in plugin.xml with lang.foldingBuilder extension point",
        "Folding regions appear in gutter with +/- icons",
        "Default state: functions expanded, deeply nested blocks collapsed",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-4.3.2"],
      "phase": 4,
      "epic": 3,
      "story_number": 3
    },
    {
      "id": "STORY-5.3.1",
      "title": "Implement Structure View",
      "intent": "Show file structure panel with functions and variables for quick navigation",
      "acceptance": [
        "Create ElvishStructureViewFactory implementing PsiStructureViewFactory",
        "Create ElvishStructureViewModel extending TextEditorBasedStructureViewModel",
        "Create ElvishStructureViewElement implementing StructureViewTreeElement",
        "Show 'fn' function definitions with their names and parameter lists",
        "Show top-level 'var' declarations",
        "Show 'use' module imports",
        "Register in plugin.xml with lang.psiStructureViewFactory extension point",
        "Clicking on item navigates to that location in the file",
        "Structure view updates when file is edited",
        "Icons differentiate functions, variables, and imports",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-4.3.3"],
      "phase": 5,
      "epic": 3,
      "story_number": 1
    },
    {
      "id": "STORY-5.3.2",
      "title": "Implement Breadcrumbs",
      "intent": "Show current code context (function name, block type) at top of editor",
      "acceptance": [
        "Create ElvishBreadcrumbsProvider implementing BreadcrumbsProvider",
        "Show function name when cursor is inside a function body",
        "Show block type (if/for/while/try) when inside control structures",
        "Show nested context for deeply nested code",
        "Register in plugin.xml with breadcrumbsInfoProvider extension point",
        "Clicking breadcrumb navigates to that scope's start",
        "Breadcrumbs respect editor setting to enable/disable",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-5.3.1"],
      "phase": 5,
      "epic": 3,
      "story_number": 2
    },
    {
      "id": "STORY-6.4.1",
      "title": "Create Elvish Run Configuration Type",
      "intent": "Allow users to run .elv scripts from the IDE with a dedicated run configuration",
      "acceptance": [
        "Create ElvishConfigurationType extending SimpleConfigurationType",
        "Create ElvishRunConfiguration extending RunConfigurationBase",
        "Configuration stores: script path, arguments, working directory, environment variables",
        "Register in plugin.xml with configurationType extension point",
        "Configuration appears in Run > Edit Configurations dialog",
        "Configuration uses Elvish file icon",
        "Configuration validates script path exists and ends with .elv",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-5.3.2"],
      "phase": 6,
      "epic": 4,
      "story_number": 1
    },
    {
      "id": "STORY-6.4.2",
      "title": "Implement Run Configuration Settings Editor",
      "intent": "Provide UI for editing Elvish run configuration settings",
      "acceptance": [
        "Create ElvishRunConfigurationEditor extending SettingsEditor",
        "UI includes: script file path with browse button",
        "UI includes: script arguments text field",
        "UI includes: working directory with browse button (defaults to project root)",
        "UI includes: environment variables editor (key=value pairs)",
        "UI includes: option to use Elvish from settings vs custom path",
        "Settings are persisted between IDE sessions",
        "applyEditorTo() and resetEditorFrom() properly sync UI and configuration",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.4.1"],
      "phase": 6,
      "epic": 4,
      "story_number": 2
    },
    {
      "id": "STORY-6.4.3",
      "title": "Implement Run Configuration Execution",
      "intent": "Execute Elvish scripts and display output in Run tool window",
      "acceptance": [
        "Create ElvishRunProfileState implementing RunProfileState",
        "Execute script using: elvish <script.elv> [args...]",
        "Use configured Elvish binary path from ElvishSettings",
        "Pass environment variables to process",
        "Set working directory correctly",
        "Output appears in Run tool window with proper colors (stdout/stderr)",
        "Exit code displayed when script completes",
        "Stop button terminates running script",
        "Re-run button works correctly",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.4.2"],
      "phase": 6,
      "epic": 4,
      "story_number": 3
    },
    {
      "id": "STORY-6.4.4",
      "title": "Add Gutter Run Icons",
      "intent": "Show run icon in gutter for .elv files to quickly run scripts",
      "acceptance": [
        "Create ElvishRunLineMarkerProvider implementing RunLineMarkerContributor",
        "Show green play icon in gutter at line 1 of .elv files",
        "Clicking icon creates and runs temporary Elvish run configuration",
        "Right-clicking icon shows: Run, Debug (disabled), Run with Coverage (disabled)",
        "Icon respects 'Run line markers' editor setting",
        "Register in plugin.xml with runLineMarkerContributor extension point",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.4.3"],
      "phase": 6,
      "epic": 4,
      "story_number": 4
    },
    {
      "id": "STORY-6.4.5",
      "title": "Implement Run Configuration Producer",
      "intent": "Auto-create run configuration when right-clicking .elv file or using context menu",
      "acceptance": [
        "Create ElvishRunConfigurationProducer extending LazyRunConfigurationProducer",
        "Right-click on .elv file in project tree shows 'Run <filename>'",
        "Context menu in editor shows 'Run <filename>'",
        "Producer creates configuration with correct script path",
        "Producer reuses existing configuration if one matches the script",
        "Register in plugin.xml with runConfigurationProducer extension point",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.4.4"],
      "phase": 6,
      "epic": 4,
      "story_number": 5
    },
    {
      "id": "STORY-7.5.1",
      "title": "Create Elvish Script File Template",
      "intent": "Add 'New > Elvish Script' option with starter template",
      "acceptance": [
        "Create file template at fileTemplates/Elvish Script.elv.ft",
        "Template includes: shebang (#!/usr/bin/env elvish)",
        "Template includes: comment header with description placeholder",
        "Template includes: newline for code to start",
        "Create description file fileTemplates/Elvish Script.elv.html",
        "New > Elvish Script appears in New File menu",
        "Dialog prompts for filename",
        "Created file has .elv extension automatically added if missing",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-6.4.5"],
      "phase": 7,
      "epic": 5,
      "story_number": 1
    },
    {
      "id": "STORY-7.5.2",
      "title": "Create Elvish Module File Template",
      "intent": "Add 'New > Elvish Module' option for creating reusable modules",
      "acceptance": [
        "Create file template at fileTemplates/Elvish Module.elv.ft",
        "Template includes: comment header with module description placeholder",
        "Template includes: example function definition with 'fn name {|args| }' syntax",
        "Template includes: comment about exporting variables",
        "Create description file fileTemplates/Elvish Module.elv.html",
        "Description explains Elvish module system and 'use' statement",
        "New > Elvish Module appears in New File menu",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-7.5.1"],
      "phase": 7,
      "epic": 5,
      "story_number": 2
    },
    {
      "id": "STORY-8.5.1",
      "title": "Create Function Definition Live Template",
      "intent": "Add 'fn' abbreviation that expands to function definition boilerplate",
      "acceptance": [
        "Create liveTemplates/Elvish.xml with templateSet group='Elvish'",
        "Template abbreviation: fn",
        "Template expands to: fn $NAME$ {|$PARAMS$|\\n  $END$\\n}",
        "$NAME$ variable: cursor stops here first",
        "$PARAMS$ variable: cursor stops here second, can be empty",
        "$END$ variable: final cursor position inside function body",
        "Template context limited to Elvish files only",
        "Template appears in completion popup when typing 'fn'",
        "Tab key cycles through template variables",
        "./gradlew build succeeds"
      ],
      "passes": true,
      "depends_on": ["STORY-7.5.2"],
      "phase": 8,
      "epic": 5,
      "story_number": 1
    },
    {
      "id": "STORY-8.5.2",
      "title": "Create Control Flow Live Templates",
      "intent": "Add live templates for if, for, while, and try control structures",
      "acceptance": [
        "Add to liveTemplates/Elvish.xml",
        "Template 'if': if $COND$ { $END$ } - basic conditional",
        "Template 'ife': if $COND$ { $THEN$ } else { $END$ } - if-else",
        "Template 'for': for $VAR$ $CONTAINER$ { $END$ } - for loop over container",
        "Template 'while': while $COND$ { $END$ } - while loop",
        "Template 'try': try { $CODE$ } catch e { $END$ } - try-catch block",
        "Template 'tryf': try { $CODE$ } finally { $END$ } - try-finally block",
        "All templates have descriptive names shown in completion popup",
        "All templates limited to Elvish context",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-8.5.1"],
      "phase": 8,
      "epic": 5,
      "story_number": 2
    },
    {
      "id": "STORY-8.5.3",
      "title": "Create Common Pattern Live Templates",
      "intent": "Add live templates for common Elvish patterns and idioms",
      "acceptance": [
        "Add to liveTemplates/Elvish.xml",
        "Template 'use': use $MODULE$ - import module (suggest: str, path, math, re, file, os)",
        "Template 'var': var $NAME$ = $VALUE$ - variable declaration",
        "Template 'set': set $NAME$ = $VALUE$ - variable assignment",
        "Template 'each': each {|$VAR$| $END$ } - iteration pattern",
        "Template 'peach': peach {|$VAR$| $END$ } - parallel iteration",
        "Template 'lambda': {|$PARAMS$| $END$ } - anonymous function",
        "Template 'map': [&$KEY$=$VALUE$ $END$] - map literal",
        "Template 'list': [$ITEMS$] - list literal",
        "All templates have descriptive tooltips explaining usage",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-8.5.2"],
      "phase": 8,
      "epic": 5,
      "story_number": 3
    },
    {
      "id": "STORY-8.5.4",
      "title": "Register Live Templates with Elvish Context",
      "intent": "Ensure live templates only appear in Elvish files and work correctly",
      "acceptance": [
        "Create ElvishTemplateContextType extending TemplateContextType",
        "Context type checks if file is Elvish language",
        "Register in plugin.xml with liveTemplateContext extension point",
        "Register template set in plugin.xml with defaultLiveTemplates extension point",
        "Templates appear in Settings > Editor > Live Templates > Elvish group",
        "Templates can be edited by user in settings",
        "Templates only expand in .elv files, not in other file types",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-8.5.3"],
      "phase": 8,
      "epic": 5,
      "story_number": 4
    },
    {
      "id": "STORY-9.6.1",
      "title": "Add TODO/FIXME highlighting in comments",
      "intent": "Highlight TODO and FIXME comments for visibility in TODO tool window",
      "acceptance": [
        "Create ElvishTodoIndexer or configure via indexPatternBuilder",
        "Recognize patterns: TODO, FIXME, XXX, HACK, BUG in # comments",
        "Pattern matching is case-insensitive",
        "Highlighted items appear in TODO tool window",
        "Register in plugin.xml with appropriate extension point",
        "Double-clicking TODO in tool window navigates to comment",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-8.5.4"],
      "phase": 9,
      "epic": 6,
      "story_number": 1
    },
    {
      "id": "STORY-9.6.2",
      "title": "Enable spell checking in comments and strings",
      "intent": "Allow spell checking in Elvish comments and string literals",
      "acceptance": [
        "Create ElvishSpellcheckingStrategy extending SpellcheckingStrategy",
        "Enable spell checking for COMMENT tokens (# comments)",
        "Enable spell checking for STRING tokens (single-quoted 'text' and double-quoted \"text\")",
        "Disable spell checking for barewords (they're often commands/paths)",
        "Register in plugin.xml with spellchecker.support extension point",
        "Misspelled words show squiggly underline",
        "Right-click offers spelling suggestions",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-9.6.1"],
      "phase": 9,
      "epic": 6,
      "story_number": 2
    },
    {
      "id": "STORY-9.6.3",
      "title": "Update documentation for new features",
      "intent": "Document all new editor features in README and CHANGELOG",
      "acceptance": [
        "README.md updated with new features section",
        "List all new features: commenter, brace matching, folding, structure view, breadcrumbs",
        "List run configuration features with usage instructions",
        "List file templates and live templates with examples",
        "CHANGELOG.md updated with all changes for version 1.1.0",
        "docs/DEVELOPMENT.md updated with architecture notes for new components",
        "./gradlew build succeeds",
        "./gradlew runIde launches without plugin errors in IDE logs"
      ],
      "passes": true,
      "depends_on": ["STORY-9.6.2"],
      "phase": 9,
      "epic": 6,
      "story_number": 3
    },
    {
      "id": "STORY-9.6.4",
      "title": "Final testing and release preparation",
      "intent": "Comprehensive testing of all features before release",
      "acceptance": [
        "All existing tests pass",
        "Manual testing of all new features in sandbox IDE",
        "Test run configuration with various scripts and arguments",
        "Test all live templates expand correctly",
        "Test file templates create proper files",
        "Plugin verifier passes for 2024.3, 2025.1, 2025.2",
        "Update plugin version to 1.1.0 in gradle.properties",
        "./gradlew buildPlugin produces distributable ZIP",
        "CHANGELOG.md has release date for 1.1.0"
      ],
      "passes": true,
      "depends_on": ["STORY-9.6.3"],
      "phase": 9,
      "epic": 6,
      "story_number": 4
    }
  ]
}
